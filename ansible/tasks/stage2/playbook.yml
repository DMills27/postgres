- hosts: localhost
  become: yes

  vars:
    sql_files:
      - "/tmp/ansible-playbook/files/pgbouncer_config/pgbouncer_auth_schema.sql"
      - "/tmp/ansible-playbook/files/stat_extension.sql"


  tasks:
    - set_fact:
        supabase_internal: true
      tags:
        - install-supabase-internal

    - set_fact:
        parallel_jobs: 16

    - name: Install Postgres from nix binary cache
      import_tasks: stage2-setup-postgres.yml

    - name: First boot optimizations
      import_tasks: optimizations.yml

    - name: Run unit tests
      import_tasks: test-image.yml
      tags:
        - unit-tests
